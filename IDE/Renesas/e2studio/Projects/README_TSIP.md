# TSIP FIT Module port
Support for TSIP FIT driver for symmetric AES, SHA1/SHA256 hardware accleration and TLS-linked capability including Root CA, the server certificate or intermediate certificate verification.

## Overview
Renesas TSIP FIT module with wolfSSL by setting *WOLFSSL_RENESAS_TSIP* definition.
 
Including the following examples:

* simple tls_client/tls_server
* crypt test
* crypt benchmark

 The *user_settings.h* file enables some of the hardened settings.

## Requirements
### 1. [Renesas TSIP FIT module](https://www.renesas.com/us/en/products/software-tools/software-os-middleware-driver/security-crypto/trusted-secure-ip-driver.html)
- [FIT module](https://www.renesas.com/us/en/products/software-tools/software-os-middleware-driver/software-package/fit.html)  
Note : The included example program is tested with TSIP FIT version 1.06.

### 2. [e2studio](https://www.renesas.com/us/en/products/software-tools/tools/ide/e2studio.html) 

### 3. Evaluation Board that suppports TSIP
Note : The included example program is tested with [GR-ROSE](http://gadget.renesas.com/en/product/rose.html), which is classified to RX65N.

## Setup and Build wolfSSL library
 1. Uncomment out #define WOLFSSL_RENESAS_TSIP in /path/to/wolfssl/wolfssl/wolfcrypt/settings.h  
    Uncomment out #define WOLFSSL_RENESAS_RX65N in /path/to/wolfssl/wolfssl/wolfcrypt/settings.h
 2. Open a project file at /path/to/wolfssl/IDE/Renesas/e2studio/Projects/wolfssl/ by e2studio and build to create wolfssl library

To disable portions of the hardware acceleration you can optionally define:  

```
/* Disabled SHA acceleration */
#define NO_WOLFSSL_RENESAS_TSIP_CRYPT_HASH
/* Disabled TLS-linked acceleration */
#define NO_WOLFSSL_RENESAS_TSIP_TLS_SESSION
```

## Setup and Build an example program
An example program expects the following FIT modules:

* r_bsp
* r_cmt_rx
* r_config
* r_ether_rx
* r_sys_time_rx
* r_t4_driver_rx
* r_t4_rx
* r_tsip_rx

These needed source files can be generated by creating a dummy project including Renesas Smart Configurator as steps below:

 1. Create a dummy project including Renesas Smart Configurator for your evaluation board type
 2. Open Smart Configurator and add FIT modules above  
    You would need to expand *User Statck Size* property and *Heap Size* of r_bsp.  
    Change IP ADDRESS and PORT NUMBER in r_t4_rx_config.h  
    `#define T4_CFG_FIXED_IP_ADDRESS_CH0   192,168,1,33`  
    `#define T4_CFG_TCP_REPID1_PORT_NUMBER 11111`  
    Note: It would need to modify other configuration base on evaluation board.
 3. Generate source code  
Now, you can copy these FIT modules into an example project.  
 4. Make "smc_gen" folder under /path/to/wolfssl/IDE/Renesas/e2studio/Projects/test/src/
 5. Copy the FIT modules into the folder that is created at step 4.
 6. Open an example project file at /path/to/wolfssl/IDE/Renesas/e2studio/Projects/test/ by e2studio  
 7. Enable a macro definition in /path/to/wolfssl/IDE/Renesas/e2studio/Projects/test/src/wolfssl_demo.h for application type
    `#define CRYPT_TEST // enable crypt test`
    `#define BENCHMARK  // enable benchmark application`
    `#define TLS_CLIENT // enable simple tls client application`
    `#define TLS_SERVER // enable simple tls server application`
    `#define USE_TSIP_TLS // inform user key and flash keying`
 7. Setup debug configuration based on your debug hardware  

### Create flash keyring and use it in an example program
 1. Please follow the instruction at TSIP manual, chapter 7. Key Data Operations.  
 2. Copy and past s_flash[] data to s_flash[] data in example-program/key_data.c  
`const uint32_t s_flash[] =`
### Create RSA key pair for signing Root CA verification and ust them in an example program
 To use TSIP TLS-linked APIs, it needs RSA key pair and Root CA certificate bundle signature by RSA 2048 PSS with SHA256. 
 The following steps describe RSA key pair generation and signing Root CA.
 
 1. Create public key and praivte key pair
 e.g. 
 openssl genrsa 2048 > private_key.pem
 openssl ras -in private_key.pem -pubout -out public_key.pem
 2. PSS signe by using created private key
 e.g.  
 openssl dgst -sha256 -sigopt rsa_padding_mode:pss -sigopt rsa_pass_saltlen:-1 -sign "private_key" -out "out_signed_file" "in_target_der_file"
 
 3. Create encrypted RSA public key for CA verification  
 Extract publicExponent and privateExponet from created key pair at step 1.  
 To generate RSA public key for CA verification, please follow the instruction at TSIP manual, chapter 7.7.

### Coding

In your application you must include <wolfssl/wolfcrypt/settings.h> before any other wolfSSL headers. If building the sources directly we recommend defining `WOLFSSL_USER_SETTINGS` and adding your own `user_settings.h` file. You can find a good reference for this in `/path/to/Renesas/e2studio/Projects/common/user_settings.h`.

## Support
 For question please email [support@wolfssl.com]

* Renesas   : e2Studio v7.4.0
* ToolChain : Renesas CCRX version 3.00.00
* Board     : [GR-ROSE](http://gadget.renesas.com/en/product/rose.html)
* wolfSSL   : 4.1.0
